{
    "AmiVersion": "3.11.0",
    "BootstrapActions": [
        {
            "Name": "Encrypt ephemeral space",
            "ScriptBootstrapAction": {
                "Args": [],
                "Path": "s3://sb-rail-rna-mapreduce/tcga_align_batch_12.dependencies/encrypt.sh"
            }
        },
        {
            "Name": "Install S3cmd",
            "ScriptBootstrapAction": {
                "Args": [],
                "Path": "s3://sb-rail-rna-mapreduce/tcga_align_batch_12.dependencies/install-s3cmd.sh"
            }
        },
        {
            "Name": "Install Rail-RNA and create JAR dependencies",
            "ScriptBootstrapAction": {
                "Args": [
                    "s3://sb-rail-rna-mapreduce/tcga_align_batch_12.dependencies/rail-rna.zip",
                    "/mnt/lib",
                    "-y",
                    "-s"
                ],
                "Path": "s3://sb-rail-rna-mapreduce/tcga_align_batch_12.dependencies/install-rail.sh"
            }
        },
        {
            "Name": "Transfer Bowtie indexes to nodes",
            "ScriptBootstrapAction": {
                "Args": [
                    "/mnt/space",
                    "s3://rail-emr-requester-pays/index/hg38.tar.gz"
                ],
                "Path": "s3://sb-rail-rna-mapreduce/tcga_align_batch_12.dependencies/install-index.sh"
            }
        },
        {
            "Name": "Transfer manifest file to nodes",
            "ScriptBootstrapAction": {
                "Args": [
                    "s3://sb-rail-rna-mapreduce/tcga_align_batch_12.dependencies/MANIFEST",
                    "/mnt/space",
                    "MANIFEST"
                ],
                "Path": "s3://sb-rail-rna-mapreduce/tcga_align_batch_12.dependencies/s3cmd_s3.sh"
            }
        },
        {
            "Name": "Allocate swap space",
            "ScriptBootstrapAction": {
                "Args": [
                    "61440",
                    "/mnt/space/swapfile"
                ],
                "Path": "s3://elasticmapreduce/bootstrap-actions/add-swap"
            }
        },
        {
            "Name": "Configure Hadoop",
            "ScriptBootstrapAction": {
                "Args": [
                    "-c",
                    "fs.s3n.multipart.uploads.enabled=true",
                    "-y",
                    "yarn.nodemanager.pmem-check-enabled=false",
                    "-y",
                    "yarn.nodemanager.vmem-check-enabled=false",
                    "-y",
                    "yarn.nodemanager.resource.memory-mb=53248",
                    "-y",
                    "yarn.scheduler.minimum-allocation-mb=1664",
                    "-y",
                    "yarn.nodemanager.vmem-pmem-ratio=2.1",
                    "-y",
                    "yarn.nodemanager.container-manager.thread-count=1",
                    "-y",
                    "yarn.nodemanager.localizer.fetch.thread-count=1",
                    "-m",
                    "mapreduce.map.speculative=true",
                    "-m",
                    "mapreduce.reduce.speculative=true",
                    "-m",
                    "mapreduce.task.timeout=1800000",
                    "-m",
                    "mapreduce.map.memory.mb=1664",
                    "-m",
                    "mapreduce.reduce.memory.mb=1664",
                    "-m",
                    "mapreduce.map.java.opts=-Xmx1331m",
                    "-m",
                    "mapreduce.reduce.java.opts=-Xmx1331m",
                    "-m",
                    "mapreduce.map.cpu.vcores=1",
                    "-m",
                    "mapreduce.reduce.cpu.vcores=1",
                    "-m",
                    "mapred.output.compress=true",
                    "-m",
                    "mapreduce.reduce.maxattempts=6",
                    "-m",
                    "mapreduce.map.maxattempts=6",
                    "-m",
                    "mapreduce.job.maps=3840",
                    "-e",
                    "fs.s3.enableServerSideEncryption=true",
                    "-e",
                    "fs.s3.consistent=false"
                ],
                "Path": "s3://us-east-1.elasticmapreduce/bootstrap-actions/configure-hadoop"
            }
        }
    ],
    "Instances": {
        "Ec2SubnetId": "subnet-b3f1319e",
        "EmrManagedMasterSecurityGroup": "sg-df507ba5",
        "EmrManagedSlaveSecurityGroup": "sg-da507ba0",
        "HadoopVersion": "2.4.0",
        "InstanceGroups": [
            {
                "BidPrice": "0.900",
                "InstanceCount": 1,
                "InstanceRole": "MASTER",
                "InstanceType": "c3.8xlarge",
                "Market": "SPOT",
                "Name": "Master Instance Group"
            },
            {
                "BidPrice": "0.900",
                "InstanceCount": 100,
                "InstanceRole": "CORE",
                "InstanceType": "c3.8xlarge",
                "Market": "SPOT",
                "Name": "Core Instance Group"
            }
        ],
        "KeepJobFlowAliveWhenNoSteps": "false",
        "TerminationProtected": "false"
    },
    "JobFlowRole": "EMR_EC2_DefaultRole",
    "LogUri": "s3://sb-rail-rna-mapreduce/tcga_align_batch_12.logs",
    "Name": "TCGA_align_batch_12_job_flow_resumed",
    "NewSupportedProducts": [],
    "ServiceRole": "EMR_DefaultRole",
    "Steps": [
        {
            "ActionOnFailure": "TERMINATE_JOB_FLOW",
            "HadoopJarStep": {
                "Args": [
                    "s3://us-east-1.elasticmapreduce/libs/state-pusher/0.1/fetch"
                ],
                "Jar": "s3://us-east-1.elasticmapreduce/libs/script-runner/script-runner.jar"
            },
            "Name": "Set up Hadoop Debugging"
        },
        {
            "ActionOnFailure": "TERMINATE_JOB_FLOW",
            "HadoopJarStep": {
                "Args": [
                    "-D",
                    "mapreduce.job.reduces=7680",
                    "-D",
                    "stream.num.map.output.key.fields=1",
                    "-D",
                    "mapreduce.partition.keypartitioner.options=-k1,1",
                    "-D",
                    "elephantbird.use.combine.input.format=true",
                    "-D",
                    "elephantbird.check.is.splitable=false",
                    "-D",
                    "elephantbird.lzo.output.index=true",
                    "-D",
                    "elephantbird.combine.split.size=536870912",
                    "-D",
                    "elephantbird.combined.split.count=3840",
                    "-D",
                    "mapreduce.reduce.memory.mb=3328",
                    "-D",
                    "mapreduce.reduce.java.opts=-Xmx2662m",
                    "-libjars",
                    "/mnt/lib/relevant-elephant.jar,/mnt/lib/custom-output-formats.jar",
                    "-partitioner",
                    "org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner",
                    "-input",
                    "s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/align_reads/postponed_sam,s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/realign_reads",
                    "-output",
                    "s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/compare_alignments2",
                    "-mapper",
                    "cut -f 2-",
                    "-reducer",
                    "pypy /usr/local/raildotbio/rail-rna/rna/steps/compare_alignments.py --bowtie-idx=/mnt/space/index/genome --partition-length=5000 --exon-differentials --tie-margin 0 --manifest=/mnt/space/MANIFEST   --output-bam-by-chr -- ",
                    "-outputformat",
                    "edu.jhu.cs.MultipleIndexedLzoTextOutputFormat",
                    "-inputformat",
                    "com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat"
                ],
                "Jar": "/home/hadoop/contrib/streaming/hadoop-streaming.jar"
            },
            "Name": "Collect and compare read alignments"
        },
        {
            "ActionOnFailure": "TERMINATE_JOB_FLOW",
            "HadoopJarStep": {
                "Args": [
                    "-D",
                    "mapreduce.job.reduces=3840",
                    "-D",
                    "stream.num.map.output.key.fields=7",
                    "-D",
                    "mapreduce.partition.keypartitioner.options=-k1,6",
                    "-D",
                    "mapreduce.job.output.key.comparator.class=org.apache.hadoop.mapred.lib.KeyFieldBasedComparator",
                    "-D",
                    "mapreduce.partition.keycomparator.options=-k1,6 -k7,7",
                    "-D",
                    "elephantbird.use.combine.input.format=true",
                    "-D",
                    "elephantbird.check.is.splitable=false",
                    "-D",
                    "elephantbird.lzo.output.index=true",
                    "-D",
                    "elephantbird.combine.split.size=268435456",
                    "-D",
                    "elephantbird.combined.split.count=3840",
                    "-libjars",
                    "/mnt/lib/relevant-elephant.jar,/mnt/lib/custom-output-formats.jar",
                    "-partitioner",
                    "org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner",
                    "-input",
                    "s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/compare_alignments2/junction_bed,s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/compare_alignments2/sam_junction_ties",
                    "-output",
                    "s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/junction_coverage",
                    "-mapper",
                    "cut -f 2-",
                    "-reducer",
                    "pypy /usr/local/raildotbio/rail-rna/rna/steps/junction_coverage.py --bowtie-idx /mnt/space/index/genome",
                    "-outputformat",
                    "edu.jhu.cs.IndexedLzoTextOutputFormat",
                    "-inputformat",
                    "com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat"
                ],
                "Jar": "/home/hadoop/contrib/streaming/hadoop-streaming.jar"
            },
            "Name": "Associate spliced reads with junction coverages"
        },
        {
            "ActionOnFailure": "TERMINATE_JOB_FLOW",
            "HadoopJarStep": {
                "Args": [
                    "-D",
                    "mapreduce.job.reduces=3840",
                    "-D",
                    "stream.num.map.output.key.fields=1",
                    "-D",
                    "mapreduce.partition.keypartitioner.options=-k1,1",
                    "-D",
                    "elephantbird.use.combine.input.format=true",
                    "-D",
                    "elephantbird.check.is.splitable=false",
                    "-D",
                    "elephantbird.lzo.output.index=true",
                    "-D",
                    "elephantbird.combine.split.size=268435456",
                    "-D",
                    "elephantbird.combined.split.count=3840",
                    "-libjars",
                    "/mnt/lib/relevant-elephant.jar,/mnt/lib/custom-output-formats.jar",
                    "-partitioner",
                    "org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner",
                    "-input",
                    "s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/junction_coverage,s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/compare_alignments2/sam_clip_ties",
                    "-output",
                    "s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/break_ties",
                    "-mapper",
                    "cut -f 2-",
                    "-reducer",
                    "pypy /usr/local/raildotbio/rail-rna/rna/steps/break_ties.py --exon-differentials --bowtie-idx /mnt/space/index/genome --partition-length 5000 --manifest /mnt/space/MANIFEST --tie-margin 0  --output-bam-by-chr -- ",
                    "-outputformat",
                    "edu.jhu.cs.MultipleIndexedLzoTextOutputFormat",
                    "-inputformat",
                    "com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat"
                ],
                "Jar": "/home/hadoop/contrib/streaming/hadoop-streaming.jar"
            },
            "Name": "Finalize primary alignments of spliced reads"
        },
        {
            "ActionOnFailure": "TERMINATE_JOB_FLOW",
            "HadoopJarStep": {
                "Args": [
                    "-D",
                    "mapreduce.job.reduces=3840",
                    "-D",
                    "stream.num.map.output.key.fields=3",
                    "-D",
                    "mapreduce.partition.keypartitioner.options=-k1,1",
                    "-D",
                    "mapreduce.job.output.key.comparator.class=org.apache.hadoop.mapred.lib.KeyFieldBasedComparator",
                    "-D",
                    "mapreduce.partition.keycomparator.options=-k1,1 -k2,3",
                    "-D",
                    "mapreduce.reduce.shuffle.input.buffer.percent=0.4",
                    "-D",
                    "mapreduce.reduce.shuffle.merge.percent=0.4",
                    "-D",
                    "elephantbird.use.combine.input.format=true",
                    "-D",
                    "elephantbird.check.is.splitable=false",
                    "-D",
                    "elephantbird.lzo.output.index=true",
                    "-D",
                    "elephantbird.combine.split.size=268435456",
                    "-D",
                    "elephantbird.combined.split.count=3840",
                    "-libjars",
                    "/mnt/lib/relevant-elephant.jar,/mnt/lib/custom-output-formats.jar,/mnt/lib/mod-partitioner.jar",
                    "-partitioner",
                    "edu.jhu.cs.ModPartitioner",
                    "-input",
                    "s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/compare_alignments2/sam,s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/break_ties/sam,s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/align_reads/sam",
                    "-output",
                    "s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/bam",
                    "-mapper",
                    "cut -f 2-",
                    "-reducer",
                    "pypy /usr/local/raildotbio/rail-rna/rna/steps/bam.py --out=S3://sb-rail-rna-mapreduce/tcga_align_batch_12/alignments --bowtie-idx=/mnt/space/index/genome --samtools-exe=samtools --bam-basename=alignments --manifest=/mnt/space/MANIFEST --keep-alive --output-by-chromosome   --suppress-bam --tie-margin 0",
                    "-outputformat",
                    "edu.jhu.cs.MultipleIndexedLzoTextOutputFormat",
                    "-inputformat",
                    "com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat"
                ],
                "Jar": "/home/hadoop/contrib/streaming/hadoop-streaming.jar"
            },
            "Name": "Count mapped reads by contig/sample"
        },
        {
            "ActionOnFailure": "TERMINATE_JOB_FLOW",
            "HadoopJarStep": {
                "Args": [
                    "-D",
                    "mapreduce.job.reduces=1",
                    "-D",
                    "stream.num.map.output.key.fields=2",
                    "-D",
                    "mapreduce.partition.keypartitioner.options=-k1,1",
                    "-D",
                    "mapreduce.job.output.key.comparator.class=org.apache.hadoop.mapred.lib.KeyFieldBasedComparator",
                    "-D",
                    "mapreduce.partition.keycomparator.options=-k1,1 -k2,2n",
                    "-D",
                    "elephantbird.use.combine.input.format=true",
                    "-D",
                    "elephantbird.check.is.splitable=false",
                    "-D",
                    "elephantbird.lzo.output.index=true",
                    "-D",
                    "elephantbird.combine.split.size=268435456",
                    "-D",
                    "elephantbird.combined.split.count=3840",
                    "-libjars",
                    "/mnt/lib/relevant-elephant.jar,/mnt/lib/custom-output-formats.jar",
                    "-partitioner",
                    "org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner",
                    "-input",
                    "s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/bam/counts",
                    "-output",
                    "s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/read_counts",
                    "-mapper",
                    "cut -f 2-",
                    "-reducer",
                    "pypy /usr/local/raildotbio/rail-rna/rna/steps/collect_read_stats.py --bowtie-idx=/mnt/space/index/genome --out=S3://sb-rail-rna-mapreduce/tcga_align_batch_12/cross_sample_results --manifest=/mnt/space/MANIFEST --gzip-level=3 --tsv-basename=  --keep-alive",
                    "-outputformat",
                    "edu.jhu.cs.IndexedLzoTextOutputFormat",
                    "-inputformat",
                    "com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat"
                ],
                "Jar": "/home/hadoop/contrib/streaming/hadoop-streaming.jar"
            },
            "Name": "Write mapped read counts"
        },
        {
            "ActionOnFailure": "TERMINATE_JOB_FLOW",
            "HadoopJarStep": {
                "Args": [
                    "-D",
                    "mapreduce.job.reduces=7680",
                    "-D",
                    "stream.num.map.output.key.fields=4",
                    "-D",
                    "mapreduce.partition.keypartitioner.options=-k1,4",
                    "-D",
                    "elephantbird.use.combine.input.format=true",
                    "-D",
                    "elephantbird.check.is.splitable=false",
                    "-D",
                    "elephantbird.lzo.output.index=true",
                    "-D",
                    "elephantbird.combine.split.size=268435456",
                    "-D",
                    "elephantbird.combined.split.count=3840",
                    "-libjars",
                    "/mnt/lib/relevant-elephant.jar,/mnt/lib/custom-output-formats.jar",
                    "-partitioner",
                    "org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner",
                    "-input",
                    "s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/align_reads/exon_diff,s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/compare_alignments2/exon_diff,s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/break_ties/exon_diff",
                    "-output",
                    "s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/collapse",
                    "-mapper",
                    "cut -f 2-",
                    "-reducer",
                    "pypy /usr/local/raildotbio/rail-rna/rna/steps/sum.py --keep-alive",
                    "-outputformat",
                    "edu.jhu.cs.IndexedLzoTextOutputFormat",
                    "-inputformat",
                    "com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat"
                ],
                "Jar": "/home/hadoop/contrib/streaming/hadoop-streaming.jar"
            },
            "Name": "Merge exon differentials at same genomic positions"
        },
        {
            "ActionOnFailure": "TERMINATE_JOB_FLOW",
            "HadoopJarStep": {
                "Args": [
                    "-D",
                    "mapreduce.job.reduces=7680",
                    "-D",
                    "stream.num.map.output.key.fields=3",
                    "-D",
                    "mapreduce.partition.keypartitioner.options=-k1,1",
                    "-D",
                    "mapreduce.job.output.key.comparator.class=org.apache.hadoop.mapred.lib.KeyFieldBasedComparator",
                    "-D",
                    "mapreduce.partition.keycomparator.options=-k1,1 -k2,3",
                    "-D",
                    "elephantbird.use.combine.input.format=true",
                    "-D",
                    "elephantbird.check.is.splitable=false",
                    "-D",
                    "elephantbird.lzo.output.index=true",
                    "-D",
                    "elephantbird.combine.split.size=268435456",
                    "-D",
                    "elephantbird.combined.split.count=3840",
                    "-libjars",
                    "/mnt/lib/relevant-elephant.jar,/mnt/lib/custom-output-formats.jar",
                    "-files",
                    "s3n://sb-rail-rna-mapreduce/tcga_align_batch_12/cross_sample_results/counts.tsv.gz#counts.tsv.gz",
                    "-partitioner",
                    "org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner",
                    "-input",
                    "s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/collapse",
                    "-output",
                    "s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/precoverage",
                    "-mapper",
                    "cut -f 2-",
                    "-reducer",
                    "pypy /usr/local/raildotbio/rail-rna/rna/steps/coverage_pre.py --bowtie-idx=/mnt/space/index/genome --library-size 40 --read-counts counts.tsv.gz --partition-stats --manifest=/mnt/space/MANIFEST --output-ave-bigwig-by-chr",
                    "-outputformat",
                    "edu.jhu.cs.MultipleIndexedLzoTextOutputFormat",
                    "-inputformat",
                    "com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat"
                ],
                "Jar": "/home/hadoop/contrib/streaming/hadoop-streaming.jar"
            },
            "Name": "Compile sample coverages from exon differentials"
        },
        {
            "ActionOnFailure": "TERMINATE_JOB_FLOW",
            "HadoopJarStep": {
                "Args": [
                    "-D",
                    "mapreduce.job.reduces=3840",
                    "-D",
                    "stream.num.map.output.key.fields=3",
                    "-D",
                    "mapreduce.partition.keypartitioner.options=-k1,1",
                    "-D",
                    "mapreduce.job.output.key.comparator.class=org.apache.hadoop.mapred.lib.KeyFieldBasedComparator",
                    "-D",
                    "mapreduce.partition.keycomparator.options=-k1,1 -k2,3",
                    "-D",
                    "elephantbird.use.combine.input.format=true",
                    "-D",
                    "elephantbird.check.is.splitable=false",
                    "-D",
                    "elephantbird.lzo.output.index=true",
                    "-D",
                    "elephantbird.combine.split.size=268435456",
                    "-D",
                    "elephantbird.combined.split.count=3840",
                    "-libjars",
                    "/mnt/lib/relevant-elephant.jar,/mnt/lib/custom-output-formats.jar,/mnt/lib/mod-partitioner.jar",
                    "-partitioner",
                    "edu.jhu.cs.ModPartitioner",
                    "-input",
                    "s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/precoverage/coverage",
                    "-output",
                    "s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/coverage",
                    "-mapper",
                    "cut -f 2-",
                    "-reducer",
                    "pypy /usr/local/raildotbio/rail-rna/rna/steps/coverage.py --bowtie-idx=/mnt/space/index/genome --percentile=0.75 --out=S3://sb-rail-rna-mapreduce/tcga_align_batch_12/coverage_bigwigs --bigwig-exe=bedGraphToBigWig --manifest=/mnt/space/MANIFEST  ",
                    "-outputformat",
                    "edu.jhu.cs.IndexedLzoTextOutputFormat",
                    "-inputformat",
                    "com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat"
                ],
                "Jar": "/home/hadoop/contrib/streaming/hadoop-streaming.jar"
            },
            "Name": "Write bigWigs with exome coverage by sample"
        },
        {
            "ActionOnFailure": "TERMINATE_JOB_FLOW",
            "HadoopJarStep": {
                "Args": [
                    "-D",
                    "mapreduce.job.reduces=7680",
                    "-D",
                    "stream.num.map.output.key.fields=6",
                    "-D",
                    "mapreduce.partition.keypartitioner.options=-k1,5",
                    "-D",
                    "mapreduce.job.output.key.comparator.class=org.apache.hadoop.mapred.lib.KeyFieldBasedComparator",
                    "-D",
                    "mapreduce.partition.keycomparator.options=-k1,5 -k6,6n",
                    "-D",
                    "elephantbird.use.combine.input.format=true",
                    "-D",
                    "elephantbird.check.is.splitable=false",
                    "-D",
                    "elephantbird.lzo.output.index=true",
                    "-D",
                    "elephantbird.combine.split.size=268435456",
                    "-D",
                    "elephantbird.combined.split.count=3840",
                    "-libjars",
                    "/mnt/lib/relevant-elephant.jar,/mnt/lib/custom-output-formats.jar",
                    "-partitioner",
                    "org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner",
                    "-input",
                    "s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/compare_alignments2/indel_bed,s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/break_ties/indel_bed,s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/compare_alignments2/junction_bed,s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/break_ties/junction_bed",
                    "-output",
                    "s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/prebed",
                    "-mapper",
                    "cut -f 2-",
                    "-reducer",
                    "pypy /usr/local/raildotbio/rail-rna/rna/steps/bed_pre.py --manifest=/mnt/space/MANIFEST --sample-fraction=0.05 --coverage-threshold=5  --keep-alive",
                    "-outputformat",
                    "edu.jhu.cs.MultipleIndexedLzoTextOutputFormat",
                    "-inputformat",
                    "com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat"
                ],
                "Jar": "/home/hadoop/contrib/streaming/hadoop-streaming.jar"
            },
            "Name": "Aggregate junctions/indels"
        },
        {
            "ActionOnFailure": "TERMINATE_JOB_FLOW",
            "HadoopJarStep": {
                "Args": [
                    "-D",
                    "mapreduce.job.reduces=3840",
                    "-D",
                    "stream.num.map.output.key.fields=5",
                    "-D",
                    "mapreduce.partition.keypartitioner.options=-k1,1",
                    "-D",
                    "mapreduce.job.output.key.comparator.class=org.apache.hadoop.mapred.lib.KeyFieldBasedComparator",
                    "-D",
                    "mapreduce.partition.keycomparator.options=-k1,1 -k2,5",
                    "-D",
                    "elephantbird.use.combine.input.format=true",
                    "-D",
                    "elephantbird.check.is.splitable=false",
                    "-D",
                    "elephantbird.lzo.output.index=true",
                    "-D",
                    "elephantbird.combine.split.size=268435456",
                    "-D",
                    "elephantbird.combined.split.count=3840",
                    "-libjars",
                    "/mnt/lib/relevant-elephant.jar,/mnt/lib/custom-output-formats.jar,/mnt/lib/mod-partitioner.jar",
                    "-partitioner",
                    "edu.jhu.cs.ModPartitioner",
                    "-input",
                    "s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/coverage,s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/prebed/collect",
                    "-output",
                    "s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/tsv",
                    "-mapper",
                    "cut -f 2-",
                    "-reducer",
                    "pypy /usr/local/raildotbio/rail-rna/rna/steps/tsv.py --bowtie-idx=/mnt/space/index/genome --out=S3://sb-rail-rna-mapreduce/tcga_align_batch_12/cross_sample_results --manifest=/mnt/space/MANIFEST --gzip-level=3 --tsv-basename=  --keep-alive",
                    "-outputformat",
                    "edu.jhu.cs.IndexedLzoTextOutputFormat",
                    "-inputformat",
                    "com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat"
                ],
                "Jar": "/home/hadoop/contrib/streaming/hadoop-streaming.jar"
            },
            "Name": "Write normalization factors/junctions/indels"
        },
        {
            "ActionOnFailure": "TERMINATE_JOB_FLOW",
            "HadoopJarStep": {
                "Args": [
                    "-D",
                    "mapreduce.job.reduces=3840",
                    "-D",
                    "stream.num.map.output.key.fields=5",
                    "-D",
                    "mapreduce.partition.keypartitioner.options=-k1,2",
                    "-D",
                    "mapreduce.job.output.key.comparator.class=org.apache.hadoop.mapred.lib.KeyFieldBasedComparator",
                    "-D",
                    "mapreduce.partition.keycomparator.options=-k1,2 -k3,5",
                    "-D",
                    "elephantbird.use.combine.input.format=true",
                    "-D",
                    "elephantbird.check.is.splitable=false",
                    "-D",
                    "elephantbird.lzo.output.index=true",
                    "-D",
                    "elephantbird.combine.split.size=268435456",
                    "-D",
                    "elephantbird.combined.split.count=3840",
                    "-libjars",
                    "/mnt/lib/relevant-elephant.jar,/mnt/lib/custom-output-formats.jar",
                    "-partitioner",
                    "org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner",
                    "-input",
                    "s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/prebed/bed",
                    "-output",
                    "s3://sb-rail-rna-mapreduce/tcga_align_batch_12.intermediate/bed",
                    "-mapper",
                    "cut -f 2-",
                    "-reducer",
                    "pypy /usr/local/raildotbio/rail-rna/rna/steps/bed.py --bowtie-idx=/mnt/space/index/genome --out=S3://sb-rail-rna-mapreduce/tcga_align_batch_12/junctions_and_indels --manifest=/mnt/space/MANIFEST --bed-basename=  --keep-alive",
                    "-outputformat",
                    "edu.jhu.cs.IndexedLzoTextOutputFormat",
                    "-inputformat",
                    "com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat"
                ],
                "Jar": "/home/hadoop/contrib/streaming/hadoop-streaming.jar"
            },
            "Name": "Write BEDs with junctions/indels by sample"
        }
    ],
    "Tags": [],
    "VisibleToAllUsers": "false"
}
